// Upload file to Pipedrive
async function uploadFile(file) {
    try {
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch('https://api.pipedrive.com/v1/files?api_token=YOUR_API_TOKEN', {
            method: 'POST',
            body: formData,
        });

        const data = await response.json();
        if (data.success) {
            console.log('File uploaded successfully:', data.data);
            return data.data.id; // Returning file_id for later use
        } else {
            console.error('Error uploading file:', data.error);
            return null;
        }
    } catch (error) {
        console.error('Error uploading file:', error);
        return null;
    }
}

// Attach file to a deal using file_id
async function attachFileToDeal(file_id, deal_id) {
    try {
        const response = await fetch(`https://api.pipedrive.com/v1/files/${file_id}/related?api_token=YOUR_API_TOKEN`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                related_type: 'deal',
                related_id: deal_id, // Linking the file to a deal
            }),
        });

        const data = await response.json();
        if (data.success) {
            console.log('File successfully attached to deal:', data);
        } else {
            console.error('Error attaching file:', data.error);
        }
    } catch (error) {
        console.error('Error attaching file to deal:', error);
    }
}

// Create a deal (just an example of deal creation)
async function createDeal() {
    try {
        const dealResponse = await fetch('https://api.pipedrive.com/v1/deals?api_token=YOUR_API_TOKEN', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: 'New Deal',
                value: 100000,
                person_id: 12345,  // Replace with actual person ID
            }),
        });

        const dealData = await dealResponse.json();
        if (dealData.success) {
            const deal_id = dealData.data.id;
            console.log('Deal created successfully:', dealData);

            // Now proceed to upload and attach files to the deal
            const file_id = await uploadFile(file); // Assuming 'file' is the file you want to upload
            if (file_id) {
                await attachFileToDeal(file_id, deal_id); // Attach file to deal after upload
            }
        } else {
            console.error('Error creating deal:', dealData.error);
        }
    } catch (error) {
        console.error('Error creating deal:', error);
    }
}
